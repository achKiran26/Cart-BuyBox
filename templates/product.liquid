<div class="product">
  <div class="width">

    <div class="prod-left">
      {%- if product.selected_or_first_available_variant.featured_image -%}
        {% assign featured = product.selected_or_first_available_variant.featured_image %}
        <img id="product-image" src="{{ featured | image_url }}" alt="" srcset="">
      {% else %}
        {% assign featured = product.featured_image %}
        <img id="product-image" src="{{ featured | image_url }}" alt="" srcset="">
      {%- endif -%}
      <ul class="product-image-thumbs">
        {% for image in product.images %}
          <li class="{% if image ==  featured %} selected {% endif %}"><img src="{{ image | image_url: width:100 }}" alt="" srcset=""></li>
        {% endfor %}
      </ul>

    </div>

    <div class="prod-right">
      <h1>{{ product.title }}</h1>

      <div class="product-prices">
        <p class="product-compare {% unless product.selected_or_first_available_variant.compare_at_price >
                                                                                                                                                                                                                            product.selected_or_first_available_variant.price%}hide{% endunless %}" style="color: red">
          {{ product.selected_or_first_available_variant.compare_at_price | money }}
        </p>
        <p class="product-price">{{ product.selected_or_first_available_variant.price | money }}</p>
      </div>

      <div>
        {{ product.description }}
      </div>

      {%- form 'product', product -%}
        <input type="hidden" name="id" id="product-id" value="{{ product.selected_or_first_available_variant.id }}">

        {% if product.variants.size > 1 %}
          <div class="product-option">
            {% for option in product.options_with_values %}
              <fieldset>
                <legend>{{ option.name }}</legend>
                {% for value in option.values %}
                  <div class="">
                    <input {% if option.selected_value == value %}
                      checked
                      {% endif %}
                      type="radio" name="{{ option.name }}" value="{{ value }}" id="{{ option.name | handlize }} - {{ value | handlize }}">
                  </div>
                  <label for="{{ option.name | handlize }} - {{ value | handlize }}">{{ value }}</label>
                {% endfor %}
              </fieldset>
            {% endfor %}
          </div>
        {% endif %}

        <div class="product-option">
          <label for="quantity">Quantity</label>
          <div class="">
            <div class="quantity-selector">
              <button type="button" class="quantity-selector-minus">
                -
              </button>
              <input id="quantity" name="quantity" value="1" class="product">
              <button type="button" class="quantity-selector-plus">
                +
              </button>
            </div>
          </div>
          

        </div>
        <div class="buttons">
          <button id="add-to-cart" type="submit"
            {%- unless product.selected_or_first_available_variant.available -%}
            disabled
            {%- endunless -%}
            class="product-add">
            {%- if product.selected_or_first_available_variant.available -%}
              Add to Cart
            {% else %}
              Out of stock
            {%- endif -%}
          </button>
          <button id="buy-it-now" type="submit"
            {%- unless product.selected_or_first_available_variant.available -%}
            disabled
            {%- endunless -%}
            class="product-add">
            {%- if product.selected_or_first_available_variant.available -%}
              Buy it now
            {% else %}
              Out of stock
            {%- endif -%}
          </button>
        </div>

      {%- endform -%}

    </div>
  </div>
</div>

<script>
  let product = {{ product | json }}

  document
  .querySelectorAll('.product-option input[type="radio"]')
  .forEach(radio => {
          radio.addEventListener('change', () => {

            // find selected options
            let selectedOptions = []

            document.querySelectorAll('.product-option input[type="radio"]:checked').forEach(radio => {
              selectedOptions.push(radio.value)
            })

            // find matchh variant
            let matchVariant = product
              .variants
              .find(variant => {
                let pass = true
                for (let i = 0; i < selectedOptions.length; i++) {
                  if (selectedOptions.indexOf(variant.options[i]) === -1) {
                    pass = false
                    break
                  }
                }
                return pass
              })

              // chnage product form variant id
              document
              .querySelector('#product-id')
              .value = matchVariant.id

            // change url
            let url = new URLParse(window.location.href, true)
            url.query.variant = matchVariant
              .id
              window
              .history
              .replaceState(null, null, url.toString())

              // change price
              document
              .querySelector('.product-price')
              .textContent = formatMoney(matchVariant.price,"{{ shop.money_format }}")
            document.querySelector('.product-compare').textContent = formatMoney(matchVariant.compare_at_price,"{{ shop.money_format }}")

            matchVariant.compare_at_price > matchVariant.price
              ? document.querySelector('.product-compare').classList.remove('hide')
              : document.querySelector('.product-compare').classList.add('hide')

            // change image
            if (matchVariant.featured_image) {
              document
                .querySelector('#product-image')
                .setAttribute('src', matchVariant.featured_image.src)
                document
                .querySelector('.product-image-thumbs li.selected')
                .classList
                .remove('selected')
              li
              .classList
              .add('selected')
            document
            .querySelectorAll('.product-image-thumbs li')[matchVariant.featured_image.position - 1]
            .classList
            .add('selected')

          // change Btn

          let add = document.querySelector('#add-to-cart')
          let buy = document.querySelector('#buy-it-now')
          if (matchVariant.available) {
            add.textContent = 'Add to Cart'
            add.disabled = false
            buy.textContent = 'Buy it now'
            buy.disabled = false
          } else {
            add.textContent = 'out of stock'
            add.disabled = true
            buy.textContent = 'out of stock'
            buy.disabled = true
          }
        }
      })}) // thumnail toggle
      document.querySelectorAll('.product-image-thumbs li')
  .forEach(li => {
      li.addEventListener('click', () => {
        document
          .querySelector('.product-image-thumbs li.selected')
          .classList
          .remove('selected')
          li
          .classList
          .add('selected')

        document
        .querySelector('#product-image')
        .setAttribute('src', li.querySelector('img').getAttribute('src'))
    })})
    document.querySelector('#buy-it-now')
  .addEventListener('click', (e) => {
    e.preventDefault()

    let form = document.querySelector('.shopify-product-form')
    let input = document.createElement('input')
    input.value = '/checkout'
    input.type = "hidden"
    input.name = "return_to"

    form.appendChild(input)
    form.submit()
  })
  //counterÂ 
  document.querySelector('.quantity-selector-plus').addEventListener('click',()=>{
    let currentValue = Number(document.querySelector('#quantity').value)
    document.querySelector('#quantity').value = currentValue + 1
  })
  document.querySelector('.quantity-selector-minus').addEventListener('click',()=>{
    let currentValue = Number(document.querySelector('#quantity').value)
    if(currentValue >1){
      document.querySelector('#quantity').value = currentValue - 1
    }
  })
</script>